{% extends "base.html" %}
{% block title %}Entités — Maturité ComNum{% endblock %}

{% block content %}
<div class="fr-grid-row fr-grid-row--middle fr-grid-row--gutters fr-mb-4w">
    <div class="fr-col">
        <h1 class="fr-h3">Entités évaluées</h1>
    </div>
    <div class="fr-col-auto">
        <a href="{{ url_for('entite_new') }}" class="fr-btn fr-btn--icon-left fr-icon-add-line">Nouvelle entité</a>
    </div>
</div>

<div class="fr-grid-row fr-grid-row--gutters">
    {% for e in entites %}
    <div class="fr-col-12 fr-col-md-4">
        <div class="fr-card">
            <div class="fr-card__body">
                <div class="fr-card__content">
                    <h3 class="fr-card__title">{{ e.nom }}</h3>
                    <p class="fr-card__desc">
                        {% if e.direction %}{{ e.direction }}{% else %}—{% endif %}
                    </p>
                    <div class="fr-card__start">
                        <p class="fr-badge fr-badge--sm fr-badge--no-icon">{{ e.type }}</p>
                        <p class="fr-badge fr-badge--sm fr-badge--info fr-badge--no-icon">{{ e.evaluations | length }} évaluation(s)</p>
                    </div>
                </div>
                <div class="fr-card__footer">
                    <ul class="fr-btns-group fr-btns-group--inline">
                        <li>
                            <a href="{{ url_for('entite_evolution', entite_id=e.id) }}" class="fr-btn fr-btn--sm fr-btn--secondary fr-btn--icon-left fr-icon-arrow-up-line">Évolution</a>
                        </li>
                        <li>
                            <button class="fr-btn fr-btn--sm fr-btn--tertiary fr-btn--icon-left fr-icon-delete-line"
                                    aria-controls="modal-delete-{{ e.id }}" data-fr-opened="false">
                                Supprimer
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Modale de confirmation de suppression -->
    <dialog id="modal-delete-{{ e.id }}" class="fr-modal" role="alertdialog" aria-labelledby="modal-delete-title-{{ e.id }}">
        <div class="fr-container fr-container--fluid fr-container-md">
            <div class="fr-grid-row fr-grid-row--center">
                <div class="fr-col-12 fr-col-md-6">
                    <div class="fr-modal__body">
                        <div class="fr-modal__header">
                            <button class="fr-btn--close fr-btn" aria-controls="modal-delete-{{ e.id }}" title="Fermer">Fermer</button>
                        </div>
                        <div class="fr-modal__content">
                            <h1 id="modal-delete-title-{{ e.id }}" class="fr-modal__title">
                                Supprimer « {{ e.nom }} » ?
                            </h1>
                            <p>Cette action est irréversible. Toutes les évaluations et scores associés à cette entité seront également supprimés.</p>
                        </div>
                        <div class="fr-modal__footer">
                            <ul class="fr-btns-group fr-btns-group--right fr-btns-group--inline">
                                <li>
                                    <button class="fr-btn fr-btn--secondary" aria-controls="modal-delete-{{ e.id }}">Annuler</button>
                                </li>
                                <li>
                                    <form method="POST" action="{{ url_for('entite_delete', entite_id=e.id) }}">
                                        <button type="submit" class="fr-btn fr-btn--icon-left fr-icon-delete-line">Confirmer la suppression</button>
                                    </form>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </dialog>
    {% endfor %}
</div>
{% endblock %}
